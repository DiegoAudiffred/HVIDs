{% extends 'layout/layout.html' %}
{% load static %}

{% block body %}
<style>
  .card {
    opacity: 0;
    transform: scale(0.9);
  }

  .card.animate {
    animation: zoomIn 1.5s ease forwards;
  }

  @keyframes zoomIn {
    to {
      opacity: 1;
      transform: scale(1);
    }
  }
</style>



<style>
  .card:hover {
    box-shadow: 0 0 15px #ff69b4, 0 0 30px #ff69b4;
    border: 2px solid #ff69b4;
    transition: all 0.4s ease;
  }
</style>
<style>
  .card-img-top {
    width: 100%;
    height: 200px;
    /* Ajusta la altura seg√∫n tus necesidades */
    object-fit: cover;
    /* Para asegurar que la imagen se ajuste sin deformarse */
  }

  .card {
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .card-body {
    flex: 1;
  }
</style>
<div class="container-fluid ">
  <div class="row align-items-center ">
    <div class="col">
      <h1 class="text-primary">Subidos Recientemente</h1>
      <a class="d-none" href="{% url 'index:show' %}">Show</a>
      <a class="d-none" href="{% url 'index:hide' %}">Hide</a>

    </div>
    <div class="col-auto">
      {% if user.is_authenticated %}
      <a class="btn btn-primary" href="{% url 'index:uploadElement' %}">Subir Archivo</a>
      {% endif %}
    </div>
  </div>


  <div class="row ">
    {% if not media_files%}

    <h1>Nada que mostrar</h1>
    {% endif %}
    {% for mediafile in media_files %}
    <div class="col-12 col-lg-6 col-xl-4  my-2">
      <div class="card h-100">

        {% if mediafile.tipo_objeto == 'comic' %}
        <a href="{% url 'index:watchComic' mediafile.id %}">
          {% else %}
          <a href="{% url 'index:watchContent' mediafile.id %}">
            {% endif %}

            {% if mediafile.image %}
            <div class="position-relative" style="aspect-ratio: 1 / 1; overflow: hidden;">
              <img src="{{ mediafile.image.url }}" alt="{{ mediafile.name }} Thumbnail" class="card-img-top w-100 h-100"
                style="object-fit: cover;">
            </div>

            {% else %}
            <div class="position-relative" style="aspect-ratio: 1 / 1; overflow: hidden;">
              <img src="{% static 'img/noImage.jpg' %}" alt="Sin imagen" class="card-img-top w-100 h-100"
                style="object-fit: cover;">
            </div>

            {% endif %}
          </a>

          <div class="card-body d-flex flex-column">
            <h5 class="card-title text-truncate">{{ mediafile.name }}</h5>
            {% if mediafile.tipo_objeto == 'comic' or mediafile.tipo_objeto == 'mediafile' %}

            <p class="card-text"><strong>Tipo:</strong>
              {% if mediafile.tipo_objeto == 'mediafile' %}
              {% if mediafile.file %} Video {% else %} Imagen {% endif %}
              {% else %}
              Imagen
              {% endif %}
            </p>
            <p class="card-text"><strong>Artista:</strong> {{ mediafile.artist }}</p>
            <p class="card-text"><strong>Serie:</strong> {{ mediafile.game }}</p>
            <p class="card-text text-truncate"><strong>Etiquetas:</strong>
              {% for tag in mediafile.tags.all %}
              <span class="badge bg-secondary">{{ tag.name }}</span>
              {% endfor %}
            </p>
            {% else %}
            asd
            {% endif %}
          </div>

          {% if mediafile.tipo_objeto == 'mediafile' and mediafile.file %}
          <div class="card-footer text-center">
            <a href="{{ mediafile.file.url }}" class="btn btn-primary text-white" target="_blank">Descargar</a>



          </div>
          {% endif %}
      </div>
    </div>
    {% endfor %}

  </div>
</div>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const cards = document.querySelectorAll(".card");

    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add("animate");
          observer.unobserve(entry.target); // Solo una vez
        }
      });
    }, {
      threshold: 0.1,
    });

    cards.forEach(card => observer.observe(card));
  });
</script>

{% endblock %}