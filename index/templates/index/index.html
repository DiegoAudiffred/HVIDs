{% extends 'layout/layout.html' %}
{% load static %}

{% block body %}
<style>
  .card {
    opacity: 0;
    transform: scale(0.9);
  }

  .card.animate {
    animation: zoomIn 1.5s ease forwards;
  }

  @keyframes zoomIn {
    to {
      opacity: 1;
      transform: scale(1);
    }
  }
</style>



<style>
  .card:hover {
    box-shadow: 0 0 15px #ff69b4, 0 0 30px #ff69b4;
    border: 2px solid #ff69b4;
    transition: all 0.4s ease;
  }
</style>
<style>
  .card-img-top {
    width: 100%;
    height: 200px;
    /* Ajusta la altura según tus necesidades */
    object-fit: cover;
    /* Para asegurar que la imagen se ajuste sin deformarse */
  }

  .card {
    height: 100%;
    display: flex;
    flex-direction: column;
  }

  .card-body {
    flex: 1;
  }
</style>
<div class="container-fluid mt-4 ">
  <div class="row align-items-center ">
    <div class="col">
      <h1 class="text-primary">Subidos Recientemente</h1>


    </div>
    <div class="col-auto">
      {% if user.is_authenticated %}
      <a class="btn btn-primary" href="{% url 'index:uploadElement' %}">Subir Archivo</a>
      {% endif %}
    </div>
  </div>


  <div class="row ">
    {% if not media_files%}

    <h3>Empieza por subir algo UwU</h3>
    {% endif %}
    {% for mediafile in media_files %}
    <div class="col-12 col-lg-6 col-xl-4 col-xxl-4 my-3">
      <div class="card h-100 shadow-sm border-0 rounded-4 overflow-hidden hover-shadow transition">

        {% if mediafile.tipo_objeto == 'comic' %}
        <a href="{% url 'index:watchComic' mediafile.id %}">
          {% else %}
          <a href="{% url 'index:watchContent' mediafile.id %}">
            {% endif %}

            <div class="position-relative" style="aspect-ratio: 1 / 1; overflow: hidden;">
              {% if mediafile.image %}
              <img src="{{ mediafile.image.url }}" alt="{{ mediafile.name }} Thumbnail"
                class="card-img-top w-100 h-100 object-fit-cover">
              {% else %}
              <img src="{% static 'img/noImage.jpg' %}" alt="Sin imagen"
                class="card-img-top w-100 h-100 object-fit-cover">
              {% endif %}
            </div>
          </a>

          <div class="card-body d-flex flex-column">
            <h5 class="card-title fw-bold text-primary text-truncate mb-2">{{ mediafile.name }}</h5>

            {% if mediafile.tipo_objeto == 'comic' or mediafile.tipo_objeto == 'mediafile' %}
            <ul class="list-unstyled small mb-2">
              <li><strong>Tipo:</strong>
                {% if mediafile.tipo_objeto == 'mediafile' %}
                {% if mediafile.file %}Video{% else %}Imagen{% endif %}
                {% else %}
                Imagen
                {% endif %}
              </li>
              <li><strong>Artista:</strong> {{ mediafile.artist }}</li>
              <li><strong>Serie:</strong> {{ mediafile.game }}</li>
              <li><strong>Likes:</strong> ❤️ {{ mediafile.total_likes }}</li>
            </ul>

            <div class="mb-2 text-truncate">
              <strong>Etiquetas:</strong><br>
              {% for tag in mediafile.tags.all %}
              <span class="badge rounded-pill bg-gradient bg-sexto text-tercero me-1 mb-1">{{ tag.name }}</span>
              {% endfor %}
            </div>
            {% else %}
            <p>Sin tags</p>
            {% endif %}
          </div>

          {% if mediafile.tipo_objeto == 'mediafile' and mediafile.file %}
          <div class="card-footer bg-transparent border-0 text-center pb-3">
            <a href="{{ mediafile.file.url }}" class="btn btn-outline-primary btn-sm" target="_blank">
              <i class="bi bi-download"></i> Descargar
            </a>
          </div>
          {% endif %}
      </div>
    </div>
    {% endfor %}


  </div>
</div>
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const cards = document.querySelectorAll(".card");

    const observer = new IntersectionObserver(entries => {
      entries.forEach(entry => {
        if (entry.isIntersecting) {
          entry.target.classList.add("animate");
          observer.unobserve(entry.target); // Solo una vez
        }
      });
    }, {
      threshold: 0.1,
    });

    cards.forEach(card => observer.observe(card));
  });
</script>

{% endblock %}