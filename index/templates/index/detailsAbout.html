{% extends 'layout/layout.html' %}
{% load static %}

{% block body %}
<style>
    .perspective-container {
        perspective: 1000px;
    }
</style>
<style>
    .rainbow-hover {
        position: relative;
        transition: transform 0.5s ease;
        transform-style: preserve-3d;
        border-radius: 1rem;
    }

    .rainbow-hover:hover {
        transform: rotateZ(3deg);
    }

    /* Marco animado */
    .rainbow-hover::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: inherit;
        padding: 3px;
        background: linear-gradient(90deg, red, orange, yellow, green, cyan, blue, violet, red);
        background-size: 400% 400%;
        animation: rainbow-border 4s linear infinite;
        -webkit-mask:
            linear-gradient(#fff 0 0) content-box,
            linear-gradient(#fff 0 0);
        -webkit-mask-composite: destination-out;
        mask-composite: exclude;
        pointer-events: none;
        opacity: 0;
        transition: opacity 0.3s ease;
        z-index: 1;
    }

    .rainbow-hover:hover::before {
        opacity: 1;
    }

    @keyframes rainbow-border {
        0% {
            background-position: 0% 50%;
        }

        100% {
            background-position: 100% 50%;
        }
    }
</style>



<div class="container-fluid mt-4">
    <div class="row border rounded-5 bg-tercero overflow-hidden shadow-lg banner-container mx-1">
        <div class="col-12 col-xl-4 p-0">
            <img src="{% if resultado.image %}{{ resultado.image.url }}{% else %}{% static 'img/noImage.jpg' %}{% endif %}"
                alt="{{ resultado.name }}" class="w-100 h-100 rounded-start-5"
                style="min-height: 450px; object-fit: cover;">
        </div>

        <div class="col-12 col-xl-8 text-white p-4">
            <div class="row h-100">
                <div
                    class="col-12 d-flex justify-content-between align-items-center mb-3 border-bottom border-secondary pb-2">
                    <h1 class="fnBadComicRegularXL text-sexto mb-0 text-truncate">{{ resultado.name }}</h1>

                    {% if request.user.is_staff and request.user.is_superuser %}
                    <a href="{% url 'index:edit_objeto' resultado.tipo_objeto resultado.id %}"
                        class="btn btn-sm btn-outline-light rounded-circle p-2 shadow-sm">
                        <img src="{% static 'img/edit.png' %}" style="width: 20px;" alt="Editar">
                    </a>
                    {% endif %}
                </div>

                <div class="col-12 col-lg-6 fnBubbleSansRegular border-end border-secondary border-opacity-25">
                    {% if resultado.tipo_objeto != "game" %}
                    <div class="mb-3 d-flex align-items-center gap-2">
                        <span class="badge bg-primary px-3 py-2 rounded-pill">
                            <strong>Género:</strong> {{ resultado.gender|title }}
                        </span>
                        {% if resultado.birthdate %}
                        <span class="badge bg-info text-dark px-3 py-2 rounded-pill">
                            <svg fill="#ffffff" width="18px" height="18px" viewBox="0 0 32 32" version="1.1"
                                class="me-1" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff">
                                <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
                                <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
                                <g id="SVGRepo_iconCarrier">
                                    <title>birthday-cake</title>
                                    <path
                                        d="M28 14.25h-3.25v-3.25c0-0.414-0.336-0.75-0.75-0.75s-0.75 0.336-0.75 0.75v0 3.25h-6.5v-3.25c0-0.414-0.336-0.75-0.75-0.75s-0.75 0.336-0.75 0.75v0 3.25h-6.5v-3.25c0-0.414-0.336-0.75-0.75-0.75s-0.75 0.336-0.75 0.75v0 3.25h-3.25c-1.518 0.002-2.748 1.232-2.75 2.75v11c0.002 1.518 1.232 2.748 2.75 2.75h24c1.518-0.002 2.748-1.232 2.75-2.75v-11c-0.002-1.518-1.232-2.748-2.75-2.75h-0zM4 15.75h3.25v2.25c0 0.414 0.336 0.75 0.75 0.75s0.75-0.336 0.75-0.75v0-2.25h6.5v2.25c0 0.414 0.336 0.75 0.75 0.75s0.75-0.336 0.75-0.75v0-2.25h6.5v2.25c0 0.414 0.336 0.75 0.75 0.75s0.75-0.336 0.75-0.75v0-2.25h3.25c0.69 0.001 1.249 0.56 1.25 1.25v7.186l-2.719-2.719c-0.142-0.134-0.334-0.217-0.546-0.217-0.021 0-0.042 0.001-0.062 0.002l0.003-0c-0.231 0.023-0.429 0.148-0.549 0.329l-0.002 0.003c-1.664 2.514-3.309 3.809-4.824 3.66-2.324-0.188-3.852-3.52-3.866-3.553-0.121-0.262-0.382-0.441-0.685-0.441s-0.562 0.178-0.682 0.435l-0.002 0.005c-0.016 0.033-1.526 3.322-3.843 3.518-1.497 0.090-3.172-1.129-4.852-3.627-0.123-0.182-0.32-0.305-0.547-0.328l-0.003-0c-0.021-0.002-0.045-0.003-0.070-0.003-0.208 0-0.396 0.083-0.533 0.218l-2.72 2.72v-7.187c0.001-0.69 0.56-1.249 1.25-1.25h0zM28 29.25h-24c-0.69-0.001-1.249-0.56-1.25-1.25v-1.691l3.15-3.151c1.867 2.516 3.791 3.699 5.704 3.543 1.903-0.366 3.477-1.538 4.377-3.14l0.017-0.032c0.918 1.654 2.505 2.842 4.386 3.204l0.040 0.006c0.111 0.008 0.223 0.014 0.334 0.014 2.307-0.29 4.245-1.649 5.327-3.556l0.018-0.035 3.147 3.148v1.69c-0.001 0.69-0.56 1.249-1.25 1.25h-0zM7.991 8.75c1.693-0.040 3.073-1.333 3.249-2.985l0.001-0.015c0-1.132-1.883-3.35-2.692-4.251-0.138-0.153-0.336-0.249-0.558-0.249h-0.001c-0.222 0-0.421 0.097-0.558 0.25l-0.001 0.001c-0.804 0.9-2.673 3.118-2.673 4.249 0.172 1.663 1.544 2.956 3.228 3l0.004 0zM7.993 3.148c0.699 0.744 1.284 1.605 1.723 2.549l0.025 0.060c-0.173 0.833-0.883 1.456-1.746 1.493l-0.004 0c-0.86-0.040-1.565-0.661-1.73-1.478l-0.002-0.012c0.457-1.005 1.039-1.867 1.739-2.617l-0.005 0.006zM15.991 8.75c1.693-0.040 3.072-1.333 3.248-2.985l0.001-0.015c0-1.132-1.882-3.35-2.691-4.251-0.138-0.153-0.336-0.249-0.558-0.249h-0.001c-0.222 0-0.421 0.097-0.558 0.25l-0.001 0.001c-0.804 0.9-2.673 3.118-2.673 4.249 0.172 1.663 1.544 2.956 3.228 3l0.004 0zM15.993 3.148c0.699 0.744 1.284 1.605 1.722 2.549l0.025 0.060c-0.135 0.851-0.863 1.493-1.741 1.493-0.877 0-1.604-0.641-1.739-1.48l-0.001-0.010c0.457-1.005 1.039-1.867 1.739-2.617l-0.005 0.006zM23.99 8.75c1.694-0.040 3.073-1.333 3.249-2.985l0.001-0.015c0-1.132-1.883-3.35-2.691-4.251-0.138-0.153-0.337-0.249-0.559-0.249h-0.002c-0.222 0.001-0.421 0.097-0.558 0.25l-0.001 0.001c-0.803 0.901-2.67 3.118-2.67 4.249 0.171 1.663 1.543 2.955 3.226 3l0.004 0zM23.992 3.149c0.699 0.744 1.285 1.605 1.723 2.548l0.025 0.060c-0.134 0.851-0.862 1.493-1.74 1.493-0.877 0-1.604-0.641-1.739-1.48l-0.001-0.010c0.456-1.004 1.037-1.867 1.737-2.616l-0.005 0.005z">
                                    </path>
                                </g>
                            </svg> {{ resultado.birthdate|date:"d M" }}
                        </span>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <p class="mb-1 text-secondary small text-uppercase fw-bold">Juego / Serie</p>
                        <p class="text-sexto fs-5">{{ resultado.game|default:"Original / Varios" }}</p>
                    </div>

                    <div class="mb-3">
                        <p class="mb-1 text-secondary small text-uppercase fw-bold">Descripción</p>
                        <div class="text-break text-light pe-2 custom-scrollbar"
                            style="max-height: 120px; overflow-y: auto;">
                            {{ resultado.description|default:"Sin descripción disponible." }}
                        </div>
                    </div>
                    {% endif %}

                    <div class="mt-4 pt-2 border-top border-secondary border-opacity-10">
                        <small class="text-secondary">Publicado el {{ resultado.published_at|date:"d/m/Y" }}</small>
                    </div>
                </div>

                <div class="col-12 col-lg-6 fnBubbleSansRegular p-lg-4">
                    <div
                        class="d-flex align-items-center justify-content-between mb-4 bg-dark bg-opacity-25 p-3 rounded-4">
                        <span class="fw-bold">Likes:</span>
                        <button class="btn btn-like p-0 border-0 bg-transparent d-flex align-items-center gap-2"
                            data-model="{{ resultado.tipo_objeto }}" data-id="{{ resultado.id }}"
                            style="outline: none; box-shadow: none;">

                            <div class="position-relative" style="width: 32px; height: 32px;">
                                <img src="{% static 'img/Liked.png' %}" alt="Liked"
                                    class="like-icon liked position-absolute top-0 start-0 w-100 h-100"
                                    style="transition: all 0.3s ease; pointer-events: none; {% if not resultado.liked_by_user %}opacity: 0; transform: scale(0.5);{% else %}opacity: 1; transform: scale(1);{% endif %}" />

                                <img src="{% static 'img/Likend.png' %}" alt="Not Liked"
                                    class="like-icon not-liked position-absolute top-0 start-0 w-100 h-100"
                                    style="transition: all 0.3s ease; pointer-events: none; {% if resultado.liked_by_user %}opacity: 0; transform: scale(0.5);{% else %}opacity: 1; transform: scale(1);{% endif %}" />
                            </div>
                            <span class="like-count text-sexto fs-4 fw-bold" style="pointer-events: none;">
                                {{resultado.total_likes }}</span>
                        </button>
                    </div>

                    <div class="mb-4">
                        <p class="mb-2 text-secondary small text-uppercase fw-bold">Etiquetas
                            ({{resultado.tags.all.count }})</p>
                        <div class="d-flex flex-wrap gap-1">
                            {% for tag in resultado.tags.all %}
                            <span class="badge bg-sexto text-tercero rounded-pill small px-2 py-1">
                                {{ tag.name }}</span>
                            {% endfor %}
                        </div>
                    </div>

                    {% if resultado.tipo_objeto != "game" %}
                    <div>
                        <p class="mb-2 text-secondary small text-uppercase fw-bold">Redes Sociales</p>
                        <div class="d-flex flex-wrap gap-2">
                            {% for red, link in resultado.social_media.items %}
                            <a href="{{ link }}" target="_blank" class="btn btn-outline-light border-0 p-1 social-hover"
                                title="{{ red|title }}">
                                <img src="{% static 'img/' %}{{ red|title }}.png"
                                    onerror="this.src='{% static 'img/link-default.png' %}'"
                                    style="width: 40px; height: 40px; object-fit: contain;" alt="{{ red }}">
                            </a>
                            {% endfor %}
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <style>
        .banner-container {
            transition: transform 0.3s ease;
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 4px;
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #9000ff;
            /* Ajusta al color de tu tema */
            border-radius: 10px;
        }

        .social-hover {
            transition: transform 0.2s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        .social-hover:hover {
            transform: scale(1.2);
            background: transparent !important;
        }

        .btn-like:active .like-icon {
            transform: scale(0.8);
        }
    </style>


    <div class="row my-4">
        {% if not contenido %}


        <div class="row align-items-center ">
            <div class="col-12 border-bottom border-3 border-primary">
                <h3 class="fw-bold text-dark">"{{resultado.name}}" no tiene nada asociado aun</h3>
            </div>
        </div>
        {% else %}
        <div class="row align-items-center ">
            <div class="col-12 border-bottom border-3 border-primary">
                <h3 class="fw-bold text-dark">Contenido reciente de "{{resultado.name}}"</h3>
            </div>
        </div>
        {% endif %}
        {% for mediafile in contenido %}
        {% include 'index/cardsTemplate.html' %}
        {% endfor %}
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const likeButtons = document.querySelectorAll('.btn-like');

        likeButtons.forEach(button => {
            button.addEventListener('click', function (e) {
                const btn = e.currentTarget;
                const model = btn.getAttribute('data-model');
                const id = btn.getAttribute('data-id');
                const countSpan = btn.querySelector('.like-count');
                const likedIcon = btn.querySelector('.liked');
                const notLikedIcon = btn.querySelector('.not-liked');

                fetch(`/toggle-like/${model}/${id}/`, {
                    method: 'POST',
                    headers: {
                        'X-CSRFToken': getCookie('csrftoken'),
                        'X-Requested-With': 'XMLHttpRequest',
                    },
                })
                    .then(response => response.json())
                    .then(data => {
                        if (data.liked !== undefined) {
                            countSpan.textContent = data.total_likes;

                            if (data.liked) {
                                likedIcon.style.opacity = '1';
                                likedIcon.style.transform = 'scale(1)';
                                notLikedIcon.style.opacity = '0';
                                notLikedIcon.style.transform = 'scale(0.5)';
                            } else {
                                likedIcon.style.opacity = '0';
                                likedIcon.style.transform = 'scale(0.5)';
                                notLikedIcon.style.opacity = '1';
                                notLikedIcon.style.transform = 'scale(1)';
                            }
                        }
                    })
                    .catch(error => console.error('Error:', error));
            });
        });

        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
    });
</script>


{% endblock %}