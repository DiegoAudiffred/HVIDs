{% load static %}

{% if instancia.tipo_objeto == "artist" %}

<form method="post" enctype="multipart/form-data">
    {% csrf_token %}
    <input type="hidden" name="form_type" value="artist_form">
    <div class="row my-5 justify-content-center" id="artistForm">

        <div class="col-lg-6 my-3 my-lg-0 col-12 text-center">




            {% if instancia.image %}
            <label for="imageInput2" style="cursor: pointer;">


                <img src="{{ instancia.image.url }}" alt="{{ mediafile.name }} Thumbnail"
                    class="img-thumbnail d-block imagePreview w-100 h-auto" style="object-fit: cover;"
                    style="max-height: 500px; object-fit: contain;" data-preview-id="1">

                {% else %}
                <label for="imageInput2" style="cursor: pointer;">

                    <img src="{% static 'img/noImage.jpg' %}" alt="Sin imagen"
                        class="img-thumbnail d-block imagePreview w-100 h-auto" style="object-fit: cover;"
                        style="max-height: 500px; object-fit: contain;" data-preview-id="1">
                    {% endif %}





                    <input type="file" name="image" id="imageInput2" accept="image/*" class="d-none imageInput"
                        data-preview-id="1">









        </div>

        <div class="col-lg-6  my-3 my-lg-0 col-12 text-start">
            <div class="my-2">
                Nombre: *
                {{ form.name }}
            </div>
            <div class="my-2">
                Sexo:
                {{ form.gender }}
            </div>
            <div class="my-2 position-relative">
                Etiquetas:
                <input type="text" id="tagInputArtist" class="rounded-3 border-3 border-primary px-4 w-100 py-2"
                    placeholder="Escribe una etiqueta y presiona Enter o Tab para autocompletar">
                <div id="tagSuggestionsArtist"
                    class="border bg-white rounded-2 mt-1 d-none position-absolute z-3 w-100">
                </div>
                <div id="tagContainerArtist" class="mt-2 d-flex flex-wrap gap-2">
                    {% for tag in instancia.tags.all %}
                    <div class="badge bg-secondary text-white rounded-pill px-3 py-2 d-flex align-items-center gap-2"
                        id="tag-{{ tag.id }}">
                        {{ tag.name }}
                        <button type="button" class="btn-close btn-close-white btn-sm ms-2"
                            aria-label="Remove"></button>
                    </div>
                    {% endfor %}

                </div>
            </div>
            <div class=" my-2">
                Descripción:
                {{ form.description }}
            </div>
            <div class="my-3">
                <label class="fw-bold mb-3 text-primary d-block">Redes Sociales</label>

                <div id="socialButtons" class="d-flex flex-wrap gap-2 mb-4">
                    <button type="button" class="btn btn-outline-light border shadow-sm p-1" data-net="facebook">
                        <img src="{% static 'img/Facebook.png' %}"
                            style="width: 40px; height: 35px; object-fit: contain;">
                    </button>
                    <button type="button" class="btn btn-outline-light border shadow-sm p-1" data-net="twitter">
                        <img src="{% static 'img/Twitter.png' %}"
                            style="width: 40px; height: 35px; object-fit: contain;">
                    </button>
                    <button type="button" class="btn btn-outline-light border shadow-sm p-1" data-net="instagram">
                        <img src="{% static 'img/Instagram.png' %}"
                            style="width: 40px; height: 35px; object-fit: contain;">
                    </button>
                    <button type="button" class="btn btn-outline-light border shadow-sm p-1" data-net="youtube">
                        <img src="{% static 'img/Youtube.png' %}"
                            style="width: 40px; height: 35px; object-fit: contain;">
                    </button>
                    <button type="button" class="btn btn-outline-light border shadow-sm p-1" data-net="tiktok">
                        <img src="{% static 'img/Tiktok.png' %}"
                            style="width: 40px; height: 35px; object-fit: contain;">
                    </button>
                    <button type="button" class="btn btn-outline-light border shadow-sm p-1" data-net="onlyfans">
                        <img src="{% static 'img/Onlyfans.png' %}"
                            style="width: 40px; height: 35px; object-fit: contain;">
                    </button>
                    <button type="button" class="btn btn-outline-light border shadow-sm p-1" data-net="rule34">
                        <img src="{% static 'img/rule34.png' %}"
                            style="width: 40px; height: 35px; object-fit: contain;">
                    </button>
                    <button type="button" class="btn btn-outline-light border shadow-sm p-1" data-net="patreon">
                        <img src="{% static 'img/patreon.png' %}"
                            style="width: 40px; height: 35px; object-fit: contain;">
                    </button>
                    <button type="button" class="btn btn-outline-light border shadow-sm p-1" data-net="coomer">
                        <img src="{% static 'img/kemono_coomer.png' %}"
                            style="width: 40px; height: 35px; object-fit: contain;">
                    </button>
                </div>

                <div id="socialInputsContainer" class="d-flex flex-column gap-3">
                    {% with social=instancia.social_media %}

                    <div id="input-facebook" class="social-input d-none input-group shadow-sm">
                        <span class="input-group-text bg-white"><img src="{% static 'img/Facebook.png' %}"
                                style="width: 25px;"></span>
                        <input type="text" class="form-control" name="facebook_url"
                            value="{{ social.facebook|default:'' }}" placeholder="URL de Facebook">
                    </div>

                    <div id="input-twitter" class="social-input d-none input-group shadow-sm">
                        <span class="input-group-text bg-white"><img src="{% static 'img/Twitter.png' %}"
                                style="width: 25px;"></span>
                        <input type="text" class="form-control" name="twitter_url"
                            value="{{ social.twitter|default:'' }}" placeholder="URL de Twitter">
                    </div>

                    <div id="input-instagram" class="social-input d-none input-group shadow-sm">
                        <span class="input-group-text bg-white"><img src="{% static 'img/Instagram.png' %}"
                                style="width: 25px;"></span>
                        <input type="text" class="form-control" name="instagram_url"
                            value="{{ social.instagram|default:'' }}" placeholder="URL de Instagram">
                    </div>

                    <div id="input-youtube" class="social-input d-none input-group shadow-sm">
                        <span class="input-group-text bg-white"><img src="{% static 'img/Youtube.png' %}"
                                style="width: 25px;"></span>
                        <input type="text" class="form-control" name="youtube_url"
                            value="{{ social.youtube|default:'' }}" placeholder="URL de Youtube">
                    </div>

                    <div id="input-tiktok" class="social-input d-none input-group shadow-sm">
                        <span class="input-group-text bg-white"><img src="{% static 'img/Tiktok.png' %}"
                                style="width: 25px;"></span>
                        <input type="text" class="form-control" name="tiktok_url" value="{{ social.tiktok|default:'' }}"
                            placeholder="URL de Tiktok">
                    </div>

                    <div id="input-onlyfans" class="social-input d-none input-group shadow-sm">
                        <span class="input-group-text bg-white"><img src="{% static 'img/Onlyfans.png' %}"
                                style="width: 25px;"></span>
                        <input type="text" class="form-control" name="onlyfans_url"
                            value="{{ social.onlyfans|default:'' }}" placeholder="URL de Onlyfans">
                    </div>

                    <div id="input-rule34" class="social-input d-none input-group shadow-sm">
                        <span class="input-group-text bg-white"><img src="{% static 'img/rule34.png' %}"
                                style="width: 25px;"></span>
                        <input type="text" class="form-control" name="rule34_url" value="{{ social.rule34|default:'' }}"
                            placeholder="URL de Rule34">
                    </div>

                    <div id="input-patreon" class="social-input d-none input-group shadow-sm">
                        <span class="input-group-text bg-white"><img src="{% static 'img/patreon.png' %}"
                                style="width: 25px;"></span>
                        <input type="text" class="form-control" name="patreon_url"
                            value="{{ social.patreon|default:'' }}" placeholder="URL de Patreon">
                    </div>

                    <div id="input-coomer" class="social-input d-none input-group shadow-sm">
                        <span class="input-group-text bg-white"><img src="{% static 'img/kemono_coomer.png' %}"
                                style="width: 25px;"></span>
                        <input type="text" class="form-control" name="coomer_url" value="{{ social.coomer|default:'' }}"
                            placeholder="URL de Coomer/Kemono">
                    </div>

                    {% endwith %}
                </div>
            </div>




            <div class="my-2">
                Cumpleaños:
                {{ form.birthdate }}
            </div>
        </div>
        <div class="my-2">
            <button type="submit" class="btn btn-success">Guardar</button>

            <a href="{% url 'index:detailsAbout' tipo instancia %}" class="btn btn-secondary">Cancelar
            </a>
        </div>
    </div>



    </div>
    <input type="text" name="tags_selectedArtist" id="tagsSelectedArtist" hidden
        value="{% for tag in instancia.tags.all %}{{ tag.name }}{% if not forloop.last %}, {% endif %}{% endfor %}">


</form>


{% endif %}
<script>
    document.addEventListener('DOMContentLoaded', function () {
        document.querySelectorAll('.social-input').forEach(container => {
            const control = container.querySelector('input, textarea');
            if (control && control.value.trim() !== '') {
                container.classList.remove('d-none');
                container.classList.add('open');
            }
        });

        const buttons = document.querySelectorAll('#socialButtons button');
        buttons.forEach(btn => {
            btn.addEventListener('click', () => {
                const net = btn.dataset.net;
                const container = document.getElementById('input-' + net);
                if (!container) return;

                const input = container.querySelector('input, textarea');

                if (!container.classList.contains('open')) {
                    container.classList.remove('d-none');
                    container.classList.add('open');
                    if (input) input.focus();
                } else {
                    if (!input || input.value.trim() === '') {
                        container.classList.remove('open');
                        container.classList.add('d-none');
                    }
                }
            });
        });
    });
</script>